<!doctype html>
<html lang="JA">
<head>
  <meta charset="UTF-8">
  <title>åº§å¸­è¡¨</title>

  <!-- jQuery / jQuery UI -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
 
  <!-- jQuery Touch Punch - Enable Touch Drag and Drop -->
  <script src="https://officeforest.org/wp/library/shapeshift/jquery.touch-punch.min.js"></script>

  <!-- jQuery.Shapeshift -->
  <script src="https://officeforest.org/wp/library/shapeshift/jquery.shapeshift.js"></script>
  <!-- CSS -->
  <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
  <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
  
  <!-- ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆ -->
  <style>
    .container {
      border: 0px dashed #CCC;
      position: relative;
      line-height: 13px;

    }
    
    .container > div {
      background: #FFFFFF;
      position: absolute;
      height: 50px;
      width: 75px;
      border-style: solid;
      border-color: #5882FA;
      font-size: 10px;
      font-weight:bold;
      text-align:center;
      display: inline-block;
      
    }
    
    .container > div:hover{
      background-color: #f5ffaa;
      -webkit-transition: all 0.2s ease;
      -moz-transition: all 0.2s ease;
      -o-transition: all 0.2s ease;
      transition: all  0.2s ease;
    }
    
    .container > div:active{
      background-color: #ffc9d7;
      -webkit-transition: all 0.2s ease;
      -moz-transition: all 0.2s ease;
      -o-transition: all 0.2s ease;
      transition: all  0.2s ease;
    }

    .container > div[data-ss-colspan="2"] { width: 130px; background:#d3ffd7;}
    .container > div[nothing="1"] { visibility:hidden; }
    .container > div[cabinet="1"] { background:#A4A4A4; color:#fff;line-height: 45px;}
    .container > div[cabinet="2"] { background:#d3ffd7;line-height: 45px;}

    .container > .ss-placeholder-child {
      background: transparent;
      border: 1px dashed blue;
    }
    
    /* ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®èƒŒæ™¯ç”»åƒå¤‰æ›´ç”¨ */
    .ui-widget-overlay {
      background: #000 url(https://nnn.ed.jp/assets/img/lp/201604/img-difference-01-pc.jpg) 10% 100% repeat-x;
      opacity: .50;
      background-size: 100% 100%;
      filter: Alpha(Opacity=70);
    }

    .box {
      float: left;
      width: 180px;
      text-align: center;
    }
    
    .box2 {
      float: left;
      width: 180px;
      text-align: center;
    }

    .boxContainer {
      overflow: hidden;
      width:100%;
    }
    
    /* clearfix */
    .boxContainer:before,
    .boxContainer:after {
      content: "";
      display: table;
    }
    
    .boxContainer:after {
      clear: both;
    }
    
    /* For IE 6/7 (trigger hasLayout) */
      .boxContainer {
      zoom: 1;
    }
  
  </style>

  <!-- Javascript -->

  <script>
    //èµ·å‹•æ™‚ã«è‡ªå‹•çš„ã«èµ·å‹•ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
    google.script.run.withSuccessHandler(onSeat).nowsheetlist();
    
    //ã‚¯ãƒªãƒƒã‚¯æ™‚ã«ç¢ºä¿ã™ã‚‹ä¸€æ™‚åº§å¸­ID
    var tempseat = "";
    

    //ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºç”¨
    $(function() {
        $( "#dialog" ).dialog({
          autoOpen: false,
          closeText: "ä¿å­˜ã›ãšã«é–‰ã˜ã¾ã™",
          width: 400,
          height: 170,
             title: "ä½œæ¥­å†…å®¹",
          modal: true,
          show: {
            effect: "clip",
            duration: 500
          },
          hide: {
            effect: "clip",
            duration: 500
          },
          position: {
            of : 'body',
            at: 'center',
            my: 'center'
          }
        });
    });	

    //ç™»éŒ²ç”¨ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºè¨­å®š
    $(function() {
        $( "#dialog2" ).dialog({
          autoOpen: false,
          closeText: "ä¿å­˜ã›ãšã«é–‰ã˜ã¾ã™",
          width: 400,
          height: 170,
             title: "ä½œæ¥­å†…å®¹",
          modal: true,
          show: {
            effect: "clip",
            duration: 500
          },
          hide: {
            effect: "clip",
            duration: 500
          },
          position: {
            of : 'body',
            at: 'center',
            my: 'center'
          }
        });
    });	

    $(function() {
        $( "input[type=submit], a, button" )
          .button()
          .click(function() {
          });
    });
    
    //ã‚·ãƒ¼ãƒˆçŠ¶æ³ã‚’ãƒãƒ£ãƒ¼ãƒˆã«åæ˜ ã™ã‚‹ã‚³ãƒ¼ãƒ‰
    function onSeat(data){
      //ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹
      var json = JSON.parse(data);
      var length = json.length;

      //ãƒ«ãƒ¼ãƒ—ã‚’å›ã—ã¦ã‚·ãƒ¼ãƒˆçŠ¶æ³ã‚’åæ˜ ã™ã‚‹
      for(var i = 0;i<length;i++){
        
        //å›ºå®šãƒ•ãƒ©ã‚°ãŒONã®ãƒ‡ãƒ¼ã‚¿ã®å ´åˆã‚¹ãƒ«ãƒ¼ã™ã‚‹
        if(json[i][1] == true){
          //
          if(json[i][2] == null || json[i][2] == ""){
            //ã‚¹ãƒ«ãƒ¼ã™ã‚‹
          }else{
            //æ—¢å®šå€¤ã‚’åæ˜ ã™ã‚‹
            document.getElementById(json[i][0]).innerHTML  = json[i][2];
            
            //æ—¢å®šå€¤ã®ã¿èƒŒæ™¯è‰²ã‚’å¤‰æ›´
            document.getElementById(json[i][0]).style.background = "#d3f1ff";
            
          }
          
        }else{
          //ãƒ‡ãƒ¼ã‚¿ãŒç©ºã®å ´åˆã«ã¯ã€ã‚¹ãƒ«ãƒ¼ã—ã€ã‚ã‚‹å ´åˆã«ã¯åæ˜ ã™ã‚‹
          if(json[i][2] == ""ã€€ || json[i][2] == null){
            //ãƒ‡ãƒ¼ã‚¿ãŒç©ºãªã®ã§ç©ºã¨ã—ã¦åæ˜ ã™ã‚‹
            document.getElementById(json[i][0]).innerHTML  = json[i][2];
            document.getElementById(json[i][0]).style.background = "";
            continue;
          }else{
            //ã‚­ãƒ¼ãƒ—æ¸ˆã¿
            document.getElementById(json[i][0]).innerHTML  = json[i][2];
            
            //ã‚­ãƒ¼ãƒ—æ¸ˆå¸­ã®èƒŒæ™¯è‰²ã‚’å¤‰æ›´
            document.getElementById(json[i][0]).style.background = "#f6d3ff";
          }
        }
      }
    }
  
    //ã‚¤ãƒ™ãƒ³ãƒˆã‚’æº–å‚™ã™ã‚‹
    $(document).ready(function() {
      //ãƒ‘ãƒãƒ«ã®æœ‰åŠ¹åŒ–
      $(".container").shapeshift({
        enableDrag: false,
        enableCrossDrop: false,
        enableResize: false,
        minColumns: 3,
        minHeight:50,
        gutterX:5,
        gutterY:5, 
        paddingX:5,
        paddingY:5
      });
      
      //ãƒ‘ãƒãƒ«ã®ã‚¯ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨­å®š
      $('.ss-active-child').on('click', function(){
        //ã‚¯ãƒªãƒƒã‚¯ã—ãŸè¦ç´ ã®IDã‚’å–å¾—
        var id =  $(this).attr("id");
        
        //ä¸€æ™‚å¤‰æ•°ã«åº§å¸­IDã‚’ç¢ºä¿
        tempseat = id;
        
        //DIVã®å€¤ã‚’å–å¾—
        var manname = $(this).html();
        
        //å–å¾—ã—ãŸIDè¦ç´ ã‚’è¡¨ç¤º
        if(id == undefined){
          alert("ğŸ’ã“ã®å¸­ã¯åº§ã‚‹äº‹ãŒå‡ºæ¥ã¾ã›ã‚“ï¼ï¼");
        }else{
          //åå‰ãŒå…¥ã£ã¦ã‚‹ã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯
          if(manname != ""){
            //ç¢ºä¿ã•ã‚Œã¦ã‚‹ã®ã§ãƒ¦ãƒ¼ã‚¶æƒ…å ±ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹
            alert("ã“ã®å¸­ã¯ã™ã§ã«ã€" + manname + "ã€‘ã•ã‚“ãŒåº§ã£ã¦ã¾ã™ã‚ˆã€‚");
            return;
          }else{
            //ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’å‚ç…§ã—ã¦å¯¾è±¡ã®IDã®å¸­ãŒç©ºã„ã¦ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            google.script.run.withSuccessHandler(onSuccess).checkseat(id);
          }
        }        
      });
    })
    
    //ã‚·ãƒ¼ãƒˆã®ç©ºãçŠ¶æ³ã‚’å–å¾—ã—ã¦å‡¦ç†ã‚’ã™ã‚‹é–¢æ•°
    function onSuccess(data){
      var json = JSON.parse(data);
      
      //è¿”ã‚Šå€¤ã‚’å…ƒã«å‡¦ç†ã‚’åˆ†å²
      if(json == true){
        //ã‚·ãƒ¼ãƒˆç¢ºä¿ç”¨ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹
        //ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
        $('#dialog').dialog({
              title: "å¸­ã®ç¢ºä¿",
              close : function(){
              }
          });
        $( "#dialog" ).dialog( "open" );
        $( "#dialog" ).dialog("moveToTop");
        document.getElementById("dialog").focus();
      
      }else{
        alert("ã“ã®åº§å¸­ã¯äºˆç´„ã§ãã¾ã›ã‚“ãƒ»ãƒ»ãƒ»ãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã€ã€Œãƒ©ãƒ³ãƒ€ãƒ ãƒ¢ãƒ¼ãƒ‰ã€ã®å ´åˆã¯äºˆç´„ã§ãã¾ã›ã‚“ã€‚");
      }
    }
    
    //ã‚·ãƒ¼ãƒˆã‚’ã‚­ãƒ¼ãƒ—ã™ã‚‹å‡¦ç†
    function seatkeep(){
      //GASå´ã¸ã‚·ãƒ¼ãƒˆç¢ºä¿å‡¦ç†ã‚’ãªã’ã‚‹
      google.script.run.withSuccessHandler(onGetSeat).getseatman(tempseat);
      
      //ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‹
      $( "#dialog" ).dialog( "close" );

    }
    
    //ã‚·ãƒ¼ãƒˆç¢ºä¿ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹é–¢æ•°
    function seatcancel(){
      //ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‹
      $( "#dialog" ).dialog( "close" );
      
      //ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
      alert("ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚");
    }
    
    //ã‚·ãƒ¼ãƒˆç¢ºä¿çµæœ
    function onGetSeat(data){
      //è¿”ã‚Šå€¤ã«ã¤ã„ã¦å–å¾—ã™ã‚‹
      var json = JSON.parse(data);

      if(json[0] == true){
        //ã‚·ãƒ¼ãƒˆãŒç¢ºä¿å‡ºæ¥ãŸå ´åˆã®å‡¦ç†
        alert("åº§å¸­ã‚’ç¢ºä¿ã—ã¾ã—ãŸã€‚");
        
        //ã‚·ãƒ¼ãƒˆãƒªã‚¹ãƒˆã®ãƒªãƒ­ãƒ¼ãƒ‰å‡¦ç†
        google.script.run.withSuccessHandler(onSeat).nowsheetlist();
        
      }else{
        //ç¢ºä¿ã§ããªã‹ã£ãŸå ´åˆã®å‡¦ç†
        alert(json[1]);
      }
    }

    //åº§å¸­ã®è§£æ”¾ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºç”¨å‡¦ç†
    function releaseseat(){
      //ã‚·ãƒ¼ãƒˆç¢ºä¿ç”¨ã®ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã™ã‚‹
      //ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤º
      $('#dialog2').dialog({
      title: "åº§å¸­ã®è§£æ”¾",
      close : function(){
      }
      });
      $( "#dialog2" ).dialog( "open" );
      $( "#dialog2" ).dialog("moveToTop");
      document.getElementById("dialog2").focus();
    }
    
    //å¸­ã®è§£æ”¾ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
    function release(){
      
      //GASå´ã¸ã‚·ãƒ¼ãƒˆç¢ºä¿å‡¦ç†ã‚’ãªã’ã‚‹
      google.script.run.withSuccessHandler(onRelSeat).relseatman();
      
      //ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‹
      $( "#dialog2" ).dialog( "close" );
    }
    
    //ã‚·ãƒ¼ãƒˆç¢ºä¿çµæœ
    function onRelSeat(data){
      //è¿”ã‚Šå€¤ã«ã¤ã„ã¦å–å¾—ã™ã‚‹
      var json = JSON.parse(data);

      if(json[0] == true){
        //ã‚·ãƒ¼ãƒˆãŒç¢ºä¿å‡ºæ¥ãŸå ´åˆã®å‡¦ç†
        alert("åº§å¸­ã‚’è§£æ”¾ã—ã¾ã—ãŸã€‚");
        
        //ã‚·ãƒ¼ãƒˆãƒªã‚¹ãƒˆã®ãƒªãƒ­ãƒ¼ãƒ‰å‡¦ç†
        google.script.run.withSuccessHandler(onSeat).nowsheetlist();
        
      }else{
        //ç¢ºä¿ã§ããªã‹ã£ãŸå ´åˆã®å‡¦ç†
        alert(json[1]);
        
        //ã‚·ãƒ¼ãƒˆãƒªã‚¹ãƒˆã®ãƒªãƒ­ãƒ¼ãƒ‰å‡¦ç†
        google.script.run.withSuccessHandler(onSeat).nowsheetlist();
        
      }
    }    
 
    //ã‚·ãƒ¼ãƒˆç¢ºä¿ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹é–¢æ•°
    function seatcancel2(){
      //ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‰ã˜ã‚‹
      $( "#dialog2" ).dialog( "close" );
      
      //ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
      alert("ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸã€‚");
    }

  </script>
</head>
<body>
  <div style="width:1000px">
    <!-- åº§å¸­ç”¨HTMLã‚’å‘¼ã³å‡ºã™ã€€-->
    <?!= HtmlService.createHtmlOutputFromFile("zaseki").getContent(); ?>
    <hr>
    <div align="right">
      <button onClick='tomasopen()' id="tomas" class="create" title='å‡ºé€€å‹¤ã‚’æ‰“åˆ»ã™ã‚‹' style="visibility:hidden">å‡ºé€€å‹¤</button>&nbsp;&nbsp;
      <button onClick='releaseseat()' id="releaseman" class="action" title='å¸­ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ã¾ã™ã€‚'>åº§å¸­ã®è§£æ”¾</button>
    </div>        
  </div>
  
  <div id="dialog" title="Basic dialog">
    <p>
    ä»Šæ—¥ã¯ã“ã®å¸­ã§æˆæ¥­ã‚’å—ã‘ã¾ã™ã‹ï¼Ÿäºˆç´„ã™ã‚‹å ´åˆã¯ã€äºˆç´„ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
    </p>

    <p></p>
    <div class='boxContainer'>
      <div class='box2'>
        <span><button onClick='seatkeep()' id="button1" style="font-size: 16px;vertical-align: middle" class="ponyo" title='å¸­ã‚’ç¢ºä¿ã—ã¾ã™ã€‚'><img src='https://officeforest.org/wp/library/icons/icon_check2.png' />&nbsp; äºˆç´„</button></span>   
      </div>
      <div class='box'>
        <span><button onClick='seatcancel()' id="button2" style="font-size: 16px;vertical-align: middle" class="ponyo" title='ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã€‚'><img src='https://officeforest.org/wp/library/icons/cross.png' />&nbsp; ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button></span>
      </div>
    </div>
  </div>
  
    <div id="dialog2" title="Basic dialog">
      <p>
      ğŸ²ä»Šæ—¥ã¯ã‚‚ã†ãŠå¸°ã‚Šã§ã™ã‹ï¼Ÿåº§å¸­ã‚’è§£æ”¾ã™ã‚‹å ´åˆã¯ã€ãƒªãƒªãƒ¼ã‚¹ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚
      </p>
      <p></p>
      <div class='boxContainer'>
        <div class='box2'>
          <span><button onClick='release()' id="button3" style="font-size: 16px;vertical-align: middle" class="ponyo" title='å¸­ã‚’è§£æ”¾ã—ã¾ã™ã€‚'><img src='https://officeforest.org/wp/library/icons/icon_check2.png' />&nbsp; ãƒªãƒªãƒ¼ã‚¹</button></span>   
        </div>
        <div class='box'>
          <span><button onClick='seatcancel2()' id="button4" style="font-size: 16px;vertical-align: middle" class="ponyo" title='ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã™ã€‚'><img src='https://officeforest.org/wp/library/icons/cross.png' />&nbsp; ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button></span>
        </div>
      </div>
    </div>
    
</body>
</html>